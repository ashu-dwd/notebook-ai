**File:** server/src/controllers/auth.controller.js

**Line(s):** 4-5
- **Issue Type:** STYLE/MAINTAINABILITY
  **Description:** The imports for `success` from `zod` and `da` from `zod/v4/locales` are declared but not used anywhere in the `auth.controller.js` file. Unused imports clutter the codebase, increase parsing time, and can indicate remnants of refactoring or incomplete features. They should be removed to improve code readability and maintainability.
  **Line(s) to Fix:** 4-5
  **Current Code:**
  ```javascript
  import { success } from "zod";
  import { da } from "zod/v4/locales";
  ```
  **Suggested Fix:**
  ```javascript
  // Remove these lines entirely.
  ```
  **Priority:** LOW

**Line(s):** 9
- **Issue Type:** STYLE/SECURITY
  **Description:** This `console.log(req.body);` statement is debug output. It should be removed from production code to avoid unnecessary log noise and prevent potential exposure of sensitive request body data in server logs.
  **Line(s) to Fix:** 9
  **Current Code:** `console.log(req.body);`
  **Suggested Fix:** `// Remove this line`
  **Priority:** LOW

**Line(s):** 17
- **Issue Type:** BUG/LOGIC/PERFORMANCE
  **Description:** The `runQuery` function is likely asynchronous, as indicated by its usage with `await` elsewhere (e.g., line 32). Calling `runQuery` without `await` means that `existingUser` will be a Promise object, not the actual database results. Consequently, `existingUser.length` on line 22 will incorrectly evaluate the length of the Promise object (which is `undefined` or `0` for an unfulfilled promise depending on the JS engine) rather than the number of query results. This critical bug prevents the correct check for existing users, leading to multiple sign-ups for the same email.
  **Line(s) to Fix:** 17
  **Current Code:** `const existingUser = runQuery(`SELECT * FROM userData WHERE email = ?`, [`
  **Suggested Fix:** `const existingUser = await runQuery(`SELECT * FROM userData WHERE email = ?`, [`
  **Priority:** HIGH

**Line(s):** 20
- **Issue Type:** STYLE/MAINTAINABILITY
  **Description:** This line contains commented-out debug code (`//console.log(existingUser);`). Commented-out code should be removed from the codebase to keep it clean, reduce cognitive load for future developers, and avoid confusion.
  **Line(s) to Fix:** 20
  **Current Code:** `//console.log(existingUser);`
  **Suggested Fix:** `// Remove this line`
  **Priority:** LOW

**Line(s):** 46, 90
- **Issue Type:** MAINTAINABILITY/DEVELOPMENT EXPERIENCE
  **Description:** The cookie configuration sets `secure: true`. While crucial for production environments to ensure cookies are only sent over HTTPS, this setting will prevent the cookie from being set if the application is running locally over HTTP (e.g., `localhost`). This can lead to unexpected behavior and debugging difficulties during development. It's best practice to conditionally set `secure` based on the environment, typically `process.env.NODE_ENV === 'production'`. This applies to both `handleUserSignUp` and `handleUserLogin`.
  **Line(s) to Fix:** 46, 90
  **Current Code:**
  ```javascript
  // Line 46
  secure: true, // Only send cookie over HTTPS
  // Line 90
  secure: true, // Only send cookie over HTTPS
  ```
  **Suggested Fix:**
  ```javascript
  // Line 46 & 90
  secure: process.env.NODE_ENV === 'production', // Set to true only in production
  ```
  **Priority:** MEDIUM

**Line(s):** 71
- **Issue Type:** BUG/LOGIC/PERFORMANCE
  **Description:** Similar to the issue on line 17, the `runQuery` call on line 71 is missing `await`. This means `user` will be a Promise object, causing `user.length === 0` on line 72 to evaluate incorrectly. This prevents proper user existence checks during login, potentially leading to errors when attempting to access `user[0].password` on line 75 if the query hasn't resolved.
  **Line(s) to Fix:** 71
  **Current Code:** `const user = runQuery(`SELECT * FROM userData WHERE email = ?`, [email]);`
  **Suggested Fix:** `const user = await runQuery(`SELECT * FROM userData WHERE email = ?`, [email]);`
  **Priority:** HIGH

---

**Overall Review Summary:**
- **Total Issues Found:** 7
- **Critical Issues:** 2 (Logical errors due to missing `await` for asynchronous database operations)
- **Code Quality Score:** 5/10
- **Approval Status:** NEEDS_CHANGES
- **Key Recommendations:**
    1.  **Critical Fix: Asynchronous Database Operations:** Ensure all calls to `runQuery` are properly `await`ed (lines 17 and 71) to correctly handle database results and prevent logical errors in user existence checks and subsequent data access.
    2.  **Improve Development Experience: Conditional Cookie Security:** Modify the `secure` flag for refresh token cookies (lines 46 and 90) to be conditional based on the environment (`process.env.NODE_ENV === 'production'`). This will allow for proper cookie handling during both local development (HTTP) and production (HTTPS).
    3.  **Code Cleanliness:** Remove all unused imports (lines 4-5), `console.log` statements (line 9), and commented-out code (line 20) to enhance readability, maintainability, and reduce unnecessary artifacts in the codebase.